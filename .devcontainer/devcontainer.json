{
	"name": "Hono Dev Container",
	"image": "mcr.microsoft.com/devcontainers/base:ubuntu-24.04",
	"workspaceFolder": "/workspaces/${localWorkspaceFolderBasename}",
	"remoteUser": "vscode",
	"mounts": [
		// Docker volume による永続ストレージ（node_modules キャッシュ）
		"source=${localWorkspaceFolderBasename}-storage,target=${localWorkspaceFolder}/.storage,type=volume",
		// root-files の一括マウント (スクリプトで展開)
		"source=${localWorkspaceFolder}/.devcontainer/root-files,target=/tmp/root-files-source,type=bind"
	],
	"runArgs": [
		// コンテナ名
		"--name",
		"hono-devcontainer",
		// host.docker.internal を有効化
		"--add-host=host.docker.internal:host-gateway"
	],
	// dockerとtailscaleを追加
	"features": {
		"ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
			"version": "latest",
			"enableNonRootDocker": "true",
			"moby": true
		},
		"ghcr.io/tailscale/codespace/tailscale": {}
	},
	// PATH に ~/.local/bin を追加、全シェルで mise が使える
	"remoteEnv": {
		"PATH": "${containerEnv:PATH}:/home/vscode/.local/bin",
		"SHELL": "/bin/bash"
	},
	// 構築ロジック: .mise.toml に基づきツールを自動インストール
	"postCreateCommand": "bash .devcontainer/createCommand.sh",
	// 接続ロジック: .env の START_DIR に基づきディレクトリを自動移動
	"postAttachCommand": "bash .devcontainer/attachCommand.sh",
	"customizations": {
		// この設定は"~/.vscode-server/data/Machine/settings.json"に書き込まれる
		"vscode": {
			"extensions": [
				"esbenp.prettier-vscode",
				"prisma.prisma",
				"bradlc.vscode-tailwindcss",
				"dbaeumer.vscode-eslint",
				"vitest.explorer",
				"mhutchie.git-graph",
				"ziyasal.vscode-open-in-github",
				"sysoev.vscode-open-in-github",
				"waderyan.gitblame",
				"formulahendry.auto-complete-tag",
				"christian-kohler.npm-intellisense",
				"christian-kohler.path-intellisense",
				"ms-python.python",
				"charliermarsh.ruff"
			],
			"settings": {
				"editor.tabSize": 2,
				"editor.defaultFormatter": "esbenp.prettier-vscode",
				"editor.formatOnSave": true,
				"editor.formatOnPaste": true,
				"editor.formatOnType": true,
				"editor.codeActionsOnSave": {
					"source.fixAll": "always",
					"source.addMissingImports": "always",
					"source.organizeImports": "always"
				},
				"files.associations": {
					"*.css": "tailwindcss"
				},
				"eslint.workingDirectories": [
					{
						"mode": "auto"
					}
				],
				"[javascript]": {
					"editor.defaultFormatter": "esbenp.prettier-vscode"
				},
				"[typescript]": {
					"editor.defaultFormatter": "esbenp.prettier-vscode"
				},
				"[json]": {
					"editor.defaultFormatter": "esbenp.prettier-vscode"
				},
				"[css]": {
					"editor.defaultFormatter": "esbenp.prettier-vscode"
				}
			}
		}
	}
}